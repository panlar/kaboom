const d=document,ls=localStorage,$levels_selector=d.getElementById("levels-selector"),$remaining_blocks=d.getElementById("remaining-blocks"),$marker=d.getElementById("marker"),$money=d.getElementById("money"),$lifes=d.getElementById("lifes"),$shop_lifes=d.getElementById("shop-lifes"),$quantity=d.getElementById("quantity"),$more_life=d.getElementById("more-life"),$less_life=d.getElementById("less-life"),$price=d.getElementById("price"),$buy=d.getElementById("buy"),$restart=d.getElementById("restart"),$record=d.getElementById("record"),$levels=d.querySelectorAll(".level"),$level_indicator=d.getElementById("level-indicator"),$game=d.getElementById("game"),$grid=d.getElementById("grid"),$info=d.getElementById("info"),levels={easy:{bombs:16,points:3},normal:{bombs:21,points:5},hard:{bombs:26,points:9}},colors={easy:"#1e90ff",normal:"#2ed573",hard:"#ff4757"};null!==ls.getItem("level")&&null!==ls.getItem("money")&&null!==ls.getItem("lifes")&&null!==ls.getItem("record-easy")&&null!==ls.getItem("record-normal")&&null!==ls.getItem("record-hard")||(ls.setItem("level","easy"),ls.setItem("money","0"),ls.setItem("lifes","3"),ls.setItem("record-easy","0"),ls.setItem("record-normal","0"),ls.setItem("record-hard","0"));let level=ls.getItem("level"),record=ls.getItem("record-"+level),money=ls.getItem("money"),lifes=JSON.parse(ls.getItem("lifes")),quantity=1,price=15,marker=0,color=d.documentElement.style.setProperty("--color",colors[level]);function loadGame(){d.querySelectorAll(".header .marker").forEach((e=>{e.style.opacity=0,e.style.animationName="popup",setTimeout((()=>{e.style.animation="",e.style.opacity=1}),1250)}));let e=JSON.parse(levels[level].bombs),t=36-e,l=new Array(36);lifes=JSON.parse(ls.getItem("lifes")),marker=0,JSON.parse(ls.getItem("lifes"))<3&&(ls.setItem("lifes","3"),lifes=3),l.fill(1,0,36),l.forEach(((e,t,l)=>l[t]=t)),$info.innerHTML='\n  <h3 class="good-luck" style="animation: slideUp 1s forwards">BUENA<br>SUERTE<br>ğŸ¤©ğŸ¤©</h3>\n  ',$remaining_blocks.textContent=t,$marker.textContent=0,$lifes.textContent=lifes,$record.textContent=ls.getItem("record-"+level),$money.textContent=ls.getItem("money"),setLevel(d.getElementById(level)),d.getElementById(level).classList.add("selected"),$level_indicator.textContent=d.getElementById(level).textContent,lessLifeButton(),setBlocks(l,e),setBombs(l,e),desKaboom()}function getRandomInt(e,t){return Math.floor(Math.random()*(t-e)+e)}function setLevel(e){$levels.forEach((e=>e.classList.remove("selected"))),e.classList.add("selected"),$level_indicator.textContent=e.textContent,ls.setItem("level",e.id),level=e.id,color=d.documentElement.style.setProperty("--color",colors[level])}function setBlocks(e,t){$grid.innerHTML="";for(let e=0;e<36;e++){let t=d.createElement("div");t.classList.add("block"),$grid.appendChild(t),35===e&&d.querySelectorAll(".block").forEach(((e,t)=>{e.style.transitionDelay=.05*t+"s",setTimeout((()=>{e.style.transform="scale(1)",e.style.opacity=1,e.style.transitionDuration="0s",e.style.transitionDelay="0s"}),50*t)}))}}function setBombs(e,t){const l=d.querySelectorAll(".block");for(let s=0;s<t;s++){let t=getRandomInt(0,e.length);l[e[t]].dataset.bomb="true",e.splice(t,1)}}function identifyBlock(e){e.dataset.bomb?(e.classList.replace("block","bomb"),e.innerHTML='<i class="bomb-img fas fa-bomb"></i>',lifes--,ls.setItem("lifes",lifes),$lifes.innerHTML-=1,0===lifes&&(kaboom(),ls.setItem("lifes","3"),$info.innerHTML='\n      <div class="game-over">\n      <h2>Juego Terminado ğŸ˜µ</h2>\n      <br><br>\n      Lastimosamente se te acabaron las vidas ğŸ™\n      <br><br>\n      Pero no te preocupes ğŸ˜„\n      <br><br>\n      Â¡Puedes volver a jugar! ğŸ¥³ğŸ¥³ğŸ¥³\n      </div>\n      ')):(e.classList.replace("block","clean"),marker+=levels[level].points,$marker.textContent=marker,money++,ls.setItem("money",money),$money.textContent=money,$remaining_blocks.innerHTML-=1,"0"===$remaining_blocks.textContent&&($info.innerHTML='\n      <div class="win">\n        <h1>Â¡FELICIDADES!<br>ğŸ¥³ğŸ¥³ğŸ¥³</h1>\n        <h3>ğŸ¤© Eres un(a) ganador(a) ğŸ¤©</h3>\n      </div>\n      '),marker>JSON.parse(ls.getItem("record-"+level))&&(ls.setItem("record-"+level,marker),$record.textContent=marker))}function selectLifes(e){if("more"===e)quantity++,price+=15,$quantity.textContent=quantity,$price.textContent=price;else{if(1===quantity)return;quantity--,price-=15,$quantity.textContent=quantity,$price.textContent=price}lessLifeButton()}function lessLifeButton(){$less_life.style.opacity=1===quantity?.5:1}function buyLifes(){price>money?$info.innerHTML=`\n    <div class="insuffucient-money">\n    Lo sentimos, aÃºn no tienes dinero suficiente para comprar ${quantity} vidas\n    <br><br>\n    Te faltan $${price-money} para poder comprarlas.\n    <br><br>\n    Â¡Â¡Â¡Sigue jugando para comprar mÃ¡s ğŸ˜„ğŸ¥³!!!\n    </div>\n    `:(0===lifes&&($info.innerHTML="\n      <div>\n      <h3>Â¡Felicidades! ğŸ¥³</h3>\n      <br><br>\n      Ahora puedes seguir jugando ğŸ¤©\n      </div>\n      ",desKaboom()),lifes+=quantity,money-=price,ls.setItem("lifes",lifes),ls.setItem("money",money),$money.textContent=ls.getItem("money"),$lifes.textContent=lifes,$shop_lifes.classList.remove("active"))}function kaboom(){d.querySelectorAll(".block").forEach((e=>{e.style.transform=`translate(${getRandomInt(-120,121)}px, ${getRandomInt(-120,121)}px)`})),$grid.classList.add("kaboom")}function desKaboom(){d.querySelectorAll(".block").forEach((e=>{e.style.transform="scale(1) translateY(0)"})),$grid.classList.remove("kaboom")}d.addEventListener("DOMContentLoaded",loadGame),$levels_selector.onclick=()=>{$levels_selector.classList.toggle("active"),$shop_lifes.classList.remove("active")},$restart.addEventListener("click",(e=>{$restart.classList.add("active"),$levels_selector.classList.remove("active"),loadGame(),setTimeout((()=>{$restart.classList.remove("active")}),500)})),d.addEventListener("click",(e=>{(e.target===$shop_lifes||e.target.matches(".shop-lifes > ion-icon"))&&($shop_lifes.classList.toggle("active"),$levels_selector.classList.remove("active")),(e.target===$more_life||e.target.matches("#more-life ion-icon"))&&selectLifes("more"),(e.target===$less_life||e.target.matches("#less-life ion-icon"))&&selectLifes(),e.target===$buy&&buyLifes(),e.target.matches(".level")&&(setLevel(e.target),loadGame()),e.target.matches(".block")&&lifes>0&&parseInt($remaining_blocks.textContent)>0&&identifyBlock(e.target)})),d.addEventListener("keydown",(e=>{123===e.keyCode&&e.preventDefault()}));d.oncontextmenu = () => false;
